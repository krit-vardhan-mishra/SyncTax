# App Overview

This document provides a high-level overview of the YouTubeMusic app architecture and components.

Components:
 - App lifecycle — When the user removes the app from the recent apps list (swipes it away), the service detects task removal and stops playback in order to avoid background battery drain. Playback will continue when the app is backgrounded normally (i.e., not removed from recents).
- Data — Room database holds `ListeningHistory`, `Songs`, and `UserPreferences`.
- When the user plays songs, the events are recorded in `ListeningHistory` and used to train local models.
- Recommendations are generated by combining multiple agents: statistical heuristics, collaborative filtering, and a Python model.
# App Overview

YouTubeMusic is an offline-first Android music player and recommendation app with on-device machine learning. It's built as an experimental example of how to combine rich local media playback with lightweight personalized recommendations that run entirely on the device — no cloud required.

Key goals
- Provide a modern, responsive music UI and playback experience using Jetpack Compose.
- Offer personalized suggestions (Quick Picks) by combining lightweight on-device approaches (statistical, collaborative, and a small Python ML model via Chaquopy).
- Keep the user's data local and ensure safeguards (resettable models, training triggered by listen events).

High-level architecture
- UI: Jetpack Compose screens (HomeScreen, QuickPickScreen, LibraryScreen) with a pinned bottom sheet playback UI powered by `UnifiedPlayer` and related components.
- Playback: `MusicService` runs as a foreground service via a persistent notification for background playback. Playback is implemented using ExoPlayer via the `MusicPlayer` wrapper.
- State & orchestration: `HomeViewModel` and `PlayerViewModel` manage UI state and coordinate repository and player behavior using Kotlin Coroutines and StateFlow.
- Data: The app uses Room for storing songs, listening history, and basic user preferences. `MusicRepository` wraps Room queries and scan operations.
- ML & Recommendations: `MusicRecommendationManager` orchestrates three primary agents:
	- `StatisticalAgent`: a feature-weighted, lightweight scoring agent operating on aggregated song/user metrics.
	- `CollaborativeFilteringAgent`: a vector-based similarity agent that uses an in-memory `VectorDatabase` to find nearest neighbors based on feature vectors.
	- `FusionAgent`: combines agent outputs into final scored recommendations.
	- Chaquopy Python ML (module `music_ml.py`): a small k-means / scorer-based model that provides an additional, z-score-based similarity estimate using the user's feature distribution; callable via `ChaquopyMusicAnalyzer`.

Data flow
- User actions (song plays) are saved into Room `ListeningHistory`. The system monitors recent history to automatically train models on the first good-size listening collection.
- The `MusicRecommendationManager` extracts engineered feature vectors per song and runs the agents (Kotlin + Python) in parallel. Results are fused and the top recommendations are surfaced as Quick Picks.

Core implementation details
- Language & platform: Kotlin for Android, Jetpack Compose UI, ExoPlayer for playback, Room for local storage. Small Python module (Chaquopy) for an optional local ML model.
- Concurrency & state: Kotlin Coroutines, StateFlow, and ViewModel lifecycles for safe concurrent behavior.
- Build & run: The app uses Gradle with the Android Gradle Plugin, and Gradle tasks are available via the `gradlew` wrapper.

Safety & user experience
- The model is trained locally and can be reset by the user using a `clearModelData()` method in the recommendation manager.
- Quick Picks are intentionally empty on first launch and display a helpful message until the user has listening history.
- The foreground `MusicService` ensures playback continues only while the app remains in the background. If the user removes the app from Recents, we stop playback to avoid battery or CPU drain (configurable behavior is possible with a setting).

Further exploration & how to extend
- Add new agents by implementing them under `core/ml/agents` and hooking them into `MusicRecommendationManager`.
- Persist model weights to disk if training on device should survive process restarts.
- Replace the in-memory vector DB with an ANN index if the dataset grows large.

See the Docs folder for more detailed descriptions of each component and the agent algorithms.

Inspiration & references
- This project is inspired by OD-MAS (Team COD3INE): https://github.com/ECVarsha/OD-MAS_Team-COD3INE

For complete developer and design documentation, see the docs in this repository.
 - The app includes a Quick Picks guide overlay on the Quick Picks screen. It can be toggled via the User Preferences if needed.
